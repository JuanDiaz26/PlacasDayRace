<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Placa Marcador Oficial V44 - Título Correcto</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700;900&family=Chakra+Petch:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --verde-tucuman: #00665c;
            --azul-oscuro: #001a2c;
            --naranja-oficial: #EF5B2B;
            --amarillo-oficial: #f1c40f;
            --blanco: #ffffff;
            --fondo-ganador: #f2f4f6; /* Gris Platino */
            --texto-oscuro: #2c3e50;
            --sombra-tablero: inset 0 0 30px rgba(0,0,0,0.8);
        }

        body { margin: 0; padding: 0; width: 1920px; height: 1080px; background: transparent; font-family: 'Roboto', sans-serif; overflow: hidden; }

        #main-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: 1600px; height: 720px; display: flex; flex-direction: column;
            filter: drop-shadow(0 30px 60px rgba(0,0,0,0.6));
            opacity: 0; transition: opacity 0.5s ease-out;
        }
        #main-container.visible { opacity: 1; }

        .layout-row { display: flex; width: 100%; }
        .col-left { width: 34%; flex-shrink: 0; } 
        .col-right { width: 66%; flex-grow: 1; }

        /* HEADER */
        .top-bar { height: 90px; display: flex; border-bottom: 6px solid var(--amarillo-oficial); border-radius: 15px 15px 0 0; overflow: hidden; z-index: 2; }
        
        .title-marcador { 
            background: var(--naranja-oficial); 
            display: flex; align-items: center; justify-content: center; 
            font-family: 'Chakra Petch'; font-size: 38px; font-weight: 900; 
            color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); 
            border-right: 2px solid rgba(0,0,0,0.2); text-align: center; line-height: 1; 
        }
        
        .title-carrera { 
            background: var(--verde-tucuman); 
            display: flex; align-items: center; padding-left: 40px; 
            /* Ajuste de fuente para que entre Nombre + Distancia */
            font-family: 'Roboto'; font-size: 30px; font-weight: 700; 
            color: white; letter-spacing: 1px;
            /* Quitamos uppercase forzado para respetar "Clasico" vs "CLASICO" */
        }
        
        .pill-num { background: white; color: var(--verde-tucuman); padding: 5px 15px; border-radius: 8px; margin-right: 20px; font-weight: 900; font-size: 38px; font-family: 'Chakra Petch'; box-shadow: 2px 2px 5px rgba(0,0,0,0.3); }

        /* CUERPO */
        .body-content { flex-grow: 1; display: flex; border-radius: 0 0 15px 15px; overflow: hidden; }

        /* RETIRADOS BLOQUE BOTTOM */
        .retirados-content { background: #001a2ca2; padding: 20px 40px; border-radius: 0 0 15px 15px; }
        .txt-retirados { color: var(--amarillo-oficial); font-size: 36px; font-weight: 900; text-transform: uppercase; margin-bottom: 15px; }

        /* IZQUIERDA */
        .col-marcador { background: #001a2ca2; box-shadow: var(--sombra-tablero); display: flex; flex-direction: column; padding: 10px 0; border-right: 4px solid var(--amarillo-oficial); z-index: 10;}
        .fila-puesto { display: flex; align-items: center; height: 16.66%; padding: 0 20px; border-bottom: 2px solid rgba(255,255,255,0.05); }
        .lbl-puesto { width: 70px; text-align: center; color: var(--amarillo-oficial); font-family: 'Chakra Petch'; font-size: 45px; font-weight: 700; margin-right: 15px; }
        .mandil-box { width: 70px; height: 70px; display: flex; justify-content: center; align-items: center; font-size: 42px; font-weight: 900; color: white; border-radius: 8px; border: 3px solid rgba(255,255,255,0.4); box-shadow: 4px 4px 10px rgba(0,0,0,0.5); margin-right: 20px; }
        .distancia-wrapper { flex-grow: 1; display: flex; align-items: center; justify-content: flex-end; }
        .dist-label-text { color: #ffffff; font-size: 24px; font-weight: 900; text-transform: uppercase; margin-right: 20px; text-align: right; line-height: 1; text-shadow: 1px 1px 2px black; }
        .chapa { width: 75px; height: 75px; flex-shrink: 0; background: var(--amarillo-oficial); border-radius: 10px; border: 4px solid #b7950b; display: flex; justify-content: center; align-items: center; font-family: 'Chakra Petch', sans-serif; color: black; box-shadow: inset 0 0 15px rgba(0,0,0,0.2); position: relative; }

        /* DERECHA */
        .col-ganador { background: #001a2ca2; display: flex; flex-direction: column; position: relative; padding: 40px 60px; }
        .logo-corner { position: absolute; bottom: 20px; left: 50px; width: 120px; height: auto; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.2)); z-index: 10; }
        .header-ganador-info { display: flex; align-items: flex-end; margin-bottom: 30px; margin-top: 30px; border-bottom: 3px solid #ccc; padding-bottom: 20px;}
        .mandil-ganador { width: 120px; height: 120px; display: flex; justify-content: center; align-items: center; font-size: 70px; font-weight: 900; color: white; border-radius: 12px; border: 4px solid rgba(0,0,0,0.1); box-shadow: 5px 5px 20px rgba(0,0,0,0.3); margin-right: 30px; }
        .textos-ganador { display: flex; flex-direction: column; justify-content: center; }
        .lbl-ganador-sup { color: var(--naranja-oficial); font-size: 24px; font-weight: 900; letter-spacing: 4px; margin-bottom: 5px; text-transform: uppercase; }
        .txt-caballo { font-family: 'Chakra Petch'; font-size: 70px; font-weight: 900; color: white; line-height: 0.9; text-transform: uppercase; text-shadow: 2px 2px 0px rgba(0,0,0,0.1); }
        .info-grid { display: grid; grid-template-columns: auto 1fr; gap: 20px 40px; align-items: center; margin-top: 20px; }
        .info-lbl { color: white; font-size: 28px; font-weight: 700; text-align: right; border-right: 5px solid var(--verde-tucuman); padding-right: 20px; }
        .info-val { color: white; font-size: 34px; font-weight: 900; text-transform: uppercase; }
        .time-box { margin-top: auto; align-self: flex-end; background: var(--azul-oscuro); border: 2px solid var(--naranja-oficial); padding: 15px 50px; border-radius: 10px; display: flex; align-items: center; gap: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
        .icon-clock { width: 50px; height: 50px; fill: var(--amarillo-oficial); }
        .txt-time-lbl { font-size: 22px; color: white; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; margin-right: 10px; }
        .txt-time-val { font-size: 60px; color: var(--amarillo-oficial); font-weight: 900; font-family: 'Chakra Petch'; line-height: 1; }

        /* GRILLAS E ICONOS */
        .dot, .ring { width: 16px; height: 16px; border-radius: 50%; }
        .dot { background: black; }
        .ring { border: 4px solid black; background: transparent; box-sizing: border-box; }
        .grid-container { display: grid; width: 100%; height: 100%; padding: 10px; box-sizing: border-box; }
        .d-1 { place-items: center; }
        .d-2 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
        .d-3 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
        .d-6 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr 1fr; row-gap: 4px; place-items: center; padding: 5px 15px; }
        .pos-tl { grid-column: 1; grid-row: 1; justify-self: center; align-self: center; }
        .pos-br { grid-column: 2; grid-row: 2; justify-self: center; align-self: center; }
        .pos-tr { grid-column: 2; grid-row: 1; justify-self: center; align-self: center; }
        .pos-bl { grid-column: 1; grid-row: 2; justify-self: center; align-self: center; }
        .pos-top-mid { grid-column: 1 / span 2; justify-self: center; align-self: end; margin-bottom: 2px; }
        .pos-bot-left { grid-column: 1; justify-self: center; align-self: start; margin-top: 2px; }
        .pos-bot-right { grid-column: 2; justify-self: center; align-self: start; margin-top: 2px; }
        
        .chapa-txt { font-size: 50px; font-weight: 900; letter-spacing: -3px; }
        .chapa-txt-vm { font-size: 30px; font-weight: 900; letter-spacing: -1px; }
        .tachado-wrapper { display: flex; justify-content: center; align-items: center; width: 100%; height: 100%; position: relative; }
        .tachado-wrapper::after { content: ''; position: absolute; width: 90%; height: 6px; background: #c0392b; transform: rotate(-45deg); }
        .pie-half { width: 45px; height: 45px; border-radius: 50%; background: conic-gradient(black 0% 50%, transparent 50% 100%); border: 3px solid black; }
        .pie-34 { width: 45px; height: 45px; border-radius: 50%; background: conic-gradient(black 0% 75%, transparent 75% 100%); border: 3px solid black; }
        .rings-container { display: flex; gap: 5px; justify-content: center; align-items: center; height: 100%; width: 100%; }
        .circle-open { width: 22px; height: 22px; border: 5px solid black; background: transparent; border-radius: 50%; flex-shrink: 0; }

        .m1 { background-color: #d32f2f; } .m2 { background-color: #ffffff; color: black !important; border: 1px solid #999; } .m3 { background-color: #1565c0; } .m4 { background-color: #fdd835; color: black !important; } .m5 { background-color: #2e7d32; } .m6 { background-color: #000000; color: #f1c40f !important; border: 1px solid #555; } .m7 { background-color: #ef6c00; } .m8 { background-color: #f48fb1; color: black !important; } .m9 { background-color: #00bcd4; color: black !important; } .m10 { background-color: #7b1fa2; } .m11 { background-color: #9e9e9e; color: #da2128 !important; } .m12 { background-color: #71bf44; color: black !important; } .m13 { background-color: #a05b09; color: #f1c40f !important; } .m14 { background-color: #b71c1c; } .m15 { background-color: #f3d19c; color: black !important; } 
    </style>
</head>
<body>
    <div id="main-container">
        <div class="top-bar layout-row">
            <div class="title-marcador col-left">MARCADOR OFICIAL</div>
            <div class="title-carrera col-right">
                <span class="pill-num" id="lbl-num-carrera">--</span>
                <span id="lbl-premio">PREMIO ...</span>
            </div>
        </div>
        <div class="body-content layout-row">
            <div class="col-marcador col-left" id="lista-puestos"></div>
            <div class="col-ganador col-right">
                <img src="logo-blanco.png" class="logo-corner" alt="Logo">
                <div class="header-ganador-info">
                    <div class="mandil-ganador" id="mandil-ganador-box">?</div>
                    <div class="textos-ganador">
                        <div class="lbl-ganador-sup">GANADOR</div>
                        <div class="txt-caballo" id="val-caballo">---</div>
                    </div>
                </div>
                <div class="info-grid">
                    <div class="info-lbl">JOCKEY</div><div class="info-val" id="val-jockey">---</div>
                    <div class="info-lbl">ENTRENADOR</div><div class="info-val" id="val-entrenador">---</div>
                    <div class="info-lbl">STUD</div><div class="info-val" id="val-stud">---</div>
                </div>
                <div class="time-box">
                    <svg class="icon-clock" viewBox="0 0 24 24"><path d="M12,2A10,10 0 1,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z" /></svg>
                    <div class="txt-time-lbl">TIEMPO:</div>
                    <div class="txt-time-val" id="val-tiempo">--' --'' --</div>
                </div>
            </div>
        </div>
        <div class="retirados-content">
            <div class="txt-retirados">Retirados:</div>
        </div>
    </div>

    <script>
        const ROMANOS = ["I", "II", "III", "IV", "V", "VI"];

        function generarIcono(codigo) {
            const c = codigo.toUpperCase().trim().replace("CPOS", "").replace("CPO", "").trim(); 
            if (!c) return ""; 

            if (["CZA", "C"].includes(c)) return `<div class="chapa"><span class="chapa-txt">C</span></div>`;
            if (["PZO", "P"].includes(c)) return `<div class="chapa"><span class="chapa-txt">P</span></div>`;
            if (["HOC", "HOCICO", "H"].includes(c)) return `<div class="chapa"><span class="chapa-txt">H</span></div>`;
            if (c.startsWith("V.M")) return `<div class="chapa"><span class="chapa-txt-vm">V.M</span></div>`;
            if (c.startsWith("S.A")) return `<div class="chapa"><span class="chapa-txt-vm">S.A</span></div>`; 

            if (c.includes("1/2 CZA")) return `<div class="chapa"><div class="tachado-wrapper"><span class="chapa-txt">C</span></div></div>`;
            if (c.includes("1/2 PZO")) return `<div class="chapa"><div class="tachado-wrapper"><span class="chapa-txt">P</span></div></div>`;

            const esMedio = c.includes("1/2") || c.includes("½");
            const elementClass = esMedio ? "ring" : "dot"; 
            
            let cantidad = 0;
            if (c.startsWith("1")) cantidad = 1;
            else if (c.startsWith("2")) cantidad = 2;
            else if (c.startsWith("3")) cantidad = 3;
            else if (c.startsWith("4")) cantidad = 4;

            if (esMedio && cantidad === 0 && !c.startsWith("0")) return `<div class="chapa"><div class="pie-half"></div></div>`;
            if (c.includes("3/4")) return `<div class="chapa"><div class="pie-34"></div></div>`;

            if (cantidad === 1) return `<div class="chapa"><div class="grid-container d-1"><div class="${elementClass}"></div></div></div>`;
            if (cantidad === 2) return `<div class="chapa"><div class="grid-container d-2"><div class="${elementClass} pos-tl"></div><div class="${elementClass} pos-br"></div></div></div>`;
            if (cantidad === 3) return `<div class="chapa"><div class="grid-container d-3"><div class="${elementClass} pos-top-mid"></div><div class="${elementClass} pos-bot-left"></div><div class="${elementClass} pos-bot-right"></div></div></div>`;
            if (cantidad === 4 && !esMedio) return `<div class="chapa"><div class="grid-container d-2"><div class="dot pos-tl"></div><div class="dot pos-tr"></div><div class="dot pos-bl"></div><div class="dot pos-br"></div></div></div>`;
            if (c.includes("VAR") || cantidad >= 5) return `<div class="chapa"><div class="grid-container d-6"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;

            return `<div class="chapa" style="font-size:14px; padding:2px;">${c}</div>`;
        }

        async function loop() {
            try {
                const r = await fetch('marcador_oficial.json?nc=' + Date.now());
                const d = await r.json();
                const container = document.getElementById('main-container');
                if (!d.visible) { container.classList.remove('visible'); return; }

                document.getElementById('lbl-num-carrera').innerText = d.carrera + "ª";
                
                // --- AQUI ESTA EL CAMBIO DEL TITULO + DISTANCIA ---
                let textoCarrera = (d.premio || ""); // Nombre limpio que viene del Python
                if (d.distancia) {
                    textoCarrera += " - " + d.distancia; // Agrega la distancia
                }
                document.getElementById('lbl-premio').innerText = textoCarrera;
                // --------------------------------------------------

                document.getElementById('val-caballo').innerText = d.ganador.nombre;
                document.getElementById('val-jockey').innerText = d.ganador.jockey;
                document.getElementById('val-entrenador').innerText = d.ganador.entrenador;
                document.getElementById('val-stud').innerText = d.ganador.stud;
                document.getElementById('val-tiempo').innerText = d.ganador.tiempo;
                
                let numGanador = d.marcador[0] ? d.marcador[0].numero : "?";
                const boxMandil = document.getElementById('mandil-ganador-box');
                boxMandil.innerText = numGanador;
                boxMandil.className = `mandil-ganador m${numGanador}`;

                const lista = document.getElementById('lista-puestos');
                lista.innerHTML = "";

                d.marcador.forEach((item, idx) => {
                    const romano = ROMANOS[idx] || (idx+1);
                    const htmlDist = generarIcono(item.distancia);
                    let textLabel = "";
                    if(idx === 0 && item.distancia) textLabel = "GANADA POR";
                    if(idx === 1 && item.distancia) textLabel = "DEL 2º AL 3º";

                    const fila = `
                        <div class="fila-puesto">
                            <span class="lbl-puesto">${romano}</span>
                            <div class="mandil-box m${item.numero}">${item.numero}</div>
                            <div class="distancia-wrapper">
                                <span class="dist-label-text">${textLabel}</span>
                                ${htmlDist}
                            </div>
                        </div>
                    `;
                    lista.innerHTML += fila;
                });
                container.classList.add('visible');
            } catch(e) {}
        }
        setInterval(loop, 500);
    </script>
</body>
</html>